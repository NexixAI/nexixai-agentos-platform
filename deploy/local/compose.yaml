name: agentos-local

services:
  stack-a:
    build:
      context: ../..
    command: ["serve","--addr",":8081","stack-a"]
    ports:
      - "50081:8081"
    environment:
      - AGENTOS_SERVICE=stack-a
      - AGENTOS_DEFAULT_TENANT=tnt_demo
      - AGENTOS_QUOTA_RUN_CREATE_QPS=10
      - AGENTOS_QUOTA_CONCURRENT_RUNS=25
      - AGENTOS_RUN_STORE_FILE=/workspace/data/stack-a/runs.json
      - AGENTOS_AUDIT_SINK=file:/workspace/data/stack-a/audit.log

  stack-b:
    build:
      context: ../..
    command: ["serve","--addr",":8082","stack-b"]
    ports:
      - "50082:8082"
    environment:
      - AGENTOS_SERVICE=stack-b
      - AGENTOS_DEFAULT_TENANT=tnt_demo
      - AGENTOS_QUOTA_INVOKE_QPS=20
      - AGENTOS_AUDIT_SINK=file:/workspace/data/stack-b/audit.log

  federation:
    build:
      context: ../..
    command: ["serve","--addr",":8083","federation"]
    ports:
      - "50083:8083"
    environment:
      - AGENTOS_SERVICE=federation
      - AGENTOS_DEFAULT_TENANT=tnt_demo
      - AGENTOS_FED_FORWARD_INDEX_FILE=/workspace/data/federation/forward-index.json
      - AGENTOS_AUDIT_SINK=file:/workspace/data/federation/audit.log
