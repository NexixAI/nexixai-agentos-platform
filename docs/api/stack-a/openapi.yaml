openapi: 3.0.3
info:
  title: "NexixAI AgentOS \u2014 Stack A (Orchestration) API"
  version: 1.0.2
  description: 'Stack A is the product-facing control plane for AgentOS: Runs, run state, and SSE events.


    Contract authority: docs/product/agentos-prs/v1.02-schemas-appendix.md'
servers:
- url: /
tags:
- name: Health
- name: Runs
- name: Events
security:
- bearerAuth: []
- apiKeyAuth: []
paths:
  /v1/health:
    get:
      tags:
      - Health
      summary: Health check
      operationId: stackAHealth
      responses:
        '200':
          description: OK
          headers:
            X-Request-Id:
              $ref: '#/components/headers/XRequestId'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              examples:
                ok:
                  value:
                    status: ok
                    service: stack-a
                    version: 1.0.2
        '503':
          $ref: '#/components/responses/ServiceUnavailable'
  /v1/agents/{agent_id}/runs:
    post:
      tags:
      - Runs
      summary: Create a run for an agent
      description: 'Creates a new run for the specified agent.


        Notes:

        - tenant_id is derived from Auth Context. A tenant header may be supported for S2S routing, but auth-derived tenant remains authoritative.

        - Use idempotency_key in the request body to make create-run idempotent for a given tenant/principal/agent.'
      operationId: createRun
      parameters:
      - $ref: '#/components/parameters/AgentId'
      - $ref: '#/components/parameters/XTenantId'
      - $ref: '#/components/parameters/XCorrelationId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RunCreateRequest'
      responses:
        '201':
          description: Created
          headers:
            X-Request-Id:
              $ref: '#/components/headers/XRequestId'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RunCreateResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'
        '429':
          $ref: '#/components/responses/RateLimited'
        '500':
          $ref: '#/components/responses/InternalError'
        '503':
          $ref: '#/components/responses/ServiceUnavailable'
  /v1/runs/{run_id}:
    get:
      tags:
      - Runs
      summary: Get run
      description: Fetches the current state of a run.
      operationId: getRun
      parameters:
      - $ref: '#/components/parameters/RunId'
      - $ref: '#/components/parameters/XTenantId'
      - $ref: '#/components/parameters/XCorrelationId'
      responses:
        '200':
          description: OK
          headers:
            X-Request-Id:
              $ref: '#/components/headers/XRequestId'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Run'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/RateLimited'
        '500':
          $ref: '#/components/responses/InternalError'
        '503':
          $ref: '#/components/responses/ServiceUnavailable'
  /v1/runs/{run_id}/events:
    get:
      tags:
      - Events
      summary: Stream run events (SSE)
      description: 'Streams run events as Server-Sent Events.


        The SSE `data:` field is a JSON object matching EventEnvelope.


        Semantics:

        - Delivery: at-least-once

        - Ordering: by event.sequence per run

        - Dedupe: by event.event_id'
      operationId: streamRunEvents
      parameters:
      - $ref: '#/components/parameters/RunId'
      - $ref: '#/components/parameters/XTenantId'
      - $ref: '#/components/parameters/XCorrelationId'
      - name: after_sequence
        in: query
        required: false
        description: Start streaming after this sequence number (exclusive).
        schema:
          type: integer
          minimum: 0
      responses:
        '200':
          description: SSE stream
          headers:
            X-Request-Id:
              $ref: '#/components/headers/XRequestId'
          content:
            text/event-stream:
              schema:
                type: string
              examples:
                envelope:
                  summary: Example SSE event (data is JSON EventEnvelope)
                  value: 'event: agentos.event

                    data: {"event":{"event_id":"evt_01JH9Y0Q7T1WZ5C0J1D8K9L0MN","sequence":12,"time":"2025-12-19T22:15:36Z","type":"agentos.run.step.started","tenant_id":"tnt_demo","agent_id":"agt_review_summarizer_v1","run_id":"run_01JH9Y0Q2KQ4R7S7X6G0M3E4F8","step_id":"stp_01JH9Y0Q4YQZ2R2FQJ8K9N8M2P","trace":{"traceparent":"00-4bf92f3577b34da6a3ce929d0e0e4736-00f067aa0ba902b7-01","span_id":"00f067aa0ba902b7"},"payload":{"name":"plan","message":"Planning next actions"}}}'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/RateLimited'
        '500':
          $ref: '#/components/responses/InternalError'
        '503':
          $ref: '#/components/responses/ServiceUnavailable'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Primary auth mechanism. Tenant context is derived from token claims.
    apiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: Optional API key for service-to-service integrations. Tenant context remains authoritative from auth context.
  headers:
    XRequestId:
      description: Request id assigned by the service (or propagated).
      schema:
        type: string
  parameters:
    AgentId:
      name: agent_id
      in: path
      required: true
      schema:
        type: string
      description: Agent identifier.
    RunId:
      name: run_id
      in: path
      required: true
      schema:
        type: string
      description: Run identifier.
    XTenantId:
      name: X-Tenant-Id
      in: header
      required: false
      schema:
        type: string
      description: Optional explicit tenant header for S2S routing; auth-derived tenant remains authoritative.
    XCorrelationId:
      name: X-Correlation-Id
      in: header
      required: false
      schema:
        type: string
      description: Correlation id for end-to-end tracing/logging.
  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFound:
      description: Not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Conflict:
      description: Conflict
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    RateLimited:
      description: Rate limited
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    ServiceUnavailable:
      description: Service unavailable
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
  schemas:
    HealthResponse:
      type: object
      required:
      - status
      - service
      - version
      properties:
        status:
          type: string
          enum:
          - ok
        service:
          type: string
          enum:
          - stack-a
        version:
          type: string
      additionalProperties: false
    RunCreateRequest:
      type: object
      required:
      - input
      - context
      - tooling
      - run_options
      - idempotency_key
      properties:
        input:
          $ref: '#/components/schemas/RunInput'
        context:
          $ref: '#/components/schemas/RunContext'
        tooling:
          $ref: '#/components/schemas/Tooling'
        run_options:
          $ref: '#/components/schemas/RunOptions'
        idempotency_key:
          type: string
      additionalProperties: false
    RunCreateResponse:
      type: object
      required:
      - run
      - correlation_id
      properties:
        run:
          $ref: '#/components/schemas/RunObject'
        correlation_id:
          type: string
      additionalProperties: false
    RunObject:
      type: object
      required:
      - run
      properties:
        run:
          $ref: '#/components/schemas/Run'
      additionalProperties: false
    Run:
      type: object
      required:
      - tenant_id
      - agent_id
      - run_id
      - status
      - created_at
      - events_url
      - output
      - error
      properties:
        tenant_id:
          type: string
        agent_id:
          type: string
        run_id:
          type: string
        status:
          type: string
          enum:
          - queued
          - running
          - completed
          - failed
          - canceled
        created_at:
          type: string
          format: date-time
        events_url:
          type: string
        output:
          nullable: true
          oneOf:
          - $ref: '#/components/schemas/RunOutput'
        error:
          nullable: true
          oneOf:
          - $ref: '#/components/schemas/RunError'
      additionalProperties: true
    RunInput:
      type: object
      required:
      - type
      - text
      properties:
        type:
          type: string
          enum:
          - text
        text:
          type: string
      additionalProperties: false
    RunContext:
      type: object
      required:
      - locale
      - timezone
      - channel
      - labels
      properties:
        locale:
          type: string
        timezone:
          type: string
        channel:
          type: string
        labels:
          type: object
          additionalProperties:
            type: string
      additionalProperties: false
    Tooling:
      type: object
      required:
      - tool_allowlist
      - tool_denymap
      properties:
        tool_allowlist:
          type: array
          items:
            type: string
        tool_denymap:
          type: array
          items:
            type: string
      additionalProperties: false
    Priority:
      type: string
      enum:
      - low
      - normal
      - high
    RunOptions:
      type: object
      required:
      - priority
      - timeout_ms
      - max_steps
      - stream_events
      - dry_run
      properties:
        priority:
          $ref: '#/components/schemas/Priority'
        timeout_ms:
          type: integer
          minimum: 0
        max_steps:
          type: integer
          minimum: 0
        stream_events:
          type: boolean
        dry_run:
          type: boolean
      additionalProperties: false
    RunOutput:
      type: object
      required:
      - type
      - text
      properties:
        type:
          type: string
          enum:
          - text
        text:
          type: string
      additionalProperties: false
    RunError:
      type: object
      required:
      - code
      - message
      properties:
        code:
          type: string
        message:
          type: string
        details:
          type: object
          additionalProperties: true
      additionalProperties: false
    EventEnvelope:
      type: object
      required:
      - event
      properties:
        event:
          $ref: '#/components/schemas/Event'
      additionalProperties: false
    Event:
      type: object
      required:
      - event_id
      - sequence
      - time
      - type
      - tenant_id
      - agent_id
      - run_id
      - trace
      - payload
      properties:
        event_id:
          type: string
        sequence:
          type: integer
          minimum: 0
        time:
          type: string
          format: date-time
        type:
          type: string
        tenant_id:
          type: string
        agent_id:
          type: string
        run_id:
          type: string
        step_id:
          type: string
        trace:
          $ref: '#/components/schemas/TraceContext'
        payload:
          type: object
          additionalProperties: true
      additionalProperties: false
    TraceContext:
      type: object
      required:
      - traceparent
      - span_id
      properties:
        traceparent:
          type: string
        span_id:
          type: string
      additionalProperties: false
    ErrorResponse:
      type: object
      required:
      - error
      - correlation_id
      properties:
        error:
          $ref: '#/components/schemas/ErrorObject'
        correlation_id:
          type: string
      additionalProperties: false
    ErrorObject:
      type: object
      required:
      - code
      - message
      - retryable
      - details
      properties:
        code:
          type: string
        message:
          type: string
        retryable:
          type: boolean
        details:
          type: object
          additionalProperties: true
      additionalProperties: false
