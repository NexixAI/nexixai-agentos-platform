openapi: 3.0.3
info:
  title: NexixAI AgentOS â€” Agent Orchestrator (Orchestration) API
  version: 1.0.2
  description: 'Agent Orchestrator (Orchestration) is the product-facing control plane for AgentOS:

    Runs, run state, and event streaming (SSE).


    Contract authority:

    - docs/product/agentos-prs/v1.02/schemas-appendix.md

    '
servers:
- url: /
tags:
- name: Health
- name: Runs
- name: Events
security:
- bearerAuth: []
- apiKeyAuth: []
paths:
  /v1/health:
    get:
      tags:
      - Health
      summary: Health check
      operationId: agentOrchestratorHealth
      responses:
        '200':
          description: OK
          headers:
            X-Request-Id:
              $ref: '#/components/headers/XRequestId'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
        '503':
          $ref: '#/components/responses/ServiceUnavailable'
  /v1/agents/{agent_id}/runs:
    post:
      tags:
      - Runs
      summary: Create a run for an agent
      description: 'Creates a new run for the specified agent.


        Notes:

        - `tenant_id` is derived from auth context. `X-Tenant-Id` may be supported
        for S2S routing by policy, but auth-derived tenant remains authoritative.

        - `idempotency_key` makes create-run idempotent for a given tenant/principal/agent.

        '
      operationId: createRun
      parameters:
      - $ref: '#/components/parameters/AgentId'
      - $ref: '#/components/parameters/XTenantId'
      - $ref: '#/components/parameters/XCorrelationId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RunCreateRequest'
      responses:
        '201':
          description: Created
          headers:
            X-Request-Id:
              $ref: '#/components/headers/XRequestId'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RunCreateResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'
        '429':
          $ref: '#/components/responses/RateLimited'
        '500':
          $ref: '#/components/responses/InternalError'
        '503':
          $ref: '#/components/responses/ServiceUnavailable'
  /v1/runs/{run_id}:
    get:
      tags:
      - Runs
      summary: Get run
      operationId: getRun
      parameters:
      - $ref: '#/components/parameters/RunId'
      - $ref: '#/components/parameters/XTenantId'
      - $ref: '#/components/parameters/XCorrelationId'
      responses:
        '200':
          description: OK
          headers:
            X-Request-Id:
              $ref: '#/components/headers/XRequestId'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RunGetResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/RateLimited'
        '500':
          $ref: '#/components/responses/InternalError'
        '503':
          $ref: '#/components/responses/ServiceUnavailable'
  /v1/runs/{run_id}:cancel:
    post:
      tags:
      - Runs
      summary: Cancel a run
      description: |
        Cancels a run that is currently in `queued` or `running` state.

        State transitions:
        - Can cancel from: `queued`, `running`
        - Cannot cancel from: `completed`, `failed`, `canceled` (returns 409 Conflict)

        Cancellation sets `status` to `canceled` and populates `completed_at`.
      operationId: cancelRun
      parameters:
      - $ref: '#/components/parameters/RunId'
      - $ref: '#/components/parameters/XTenantId'
      - $ref: '#/components/parameters/XCorrelationId'
      responses:
        '200':
          description: Run canceled successfully
          headers:
            X-Request-Id:
              $ref: '#/components/headers/XRequestId'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RunCancelResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '429':
          $ref: '#/components/responses/RateLimited'
        '500':
          $ref: '#/components/responses/InternalError'
        '503':
          $ref: '#/components/responses/ServiceUnavailable'
  /v1/runs/{run_id}/events:
    get:
      tags:
      - Events
      summary: Stream run events (SSE)
      description: 'Streams run events as Server-Sent Events.


        The SSE `data:` field is a JSON object matching `EventEnvelope`.


        Semantics:

        - Delivery: at-least-once

        - Ordering: by `event.sequence` per run

        - Dedupe: by `event.event_id`

        '
      operationId: streamRunEvents
      parameters:
      - $ref: '#/components/parameters/RunId'
      - $ref: '#/components/parameters/XTenantId'
      - $ref: '#/components/parameters/XCorrelationId'
      - name: after_sequence
        in: query
        required: false
        description: Start streaming after this sequence number (exclusive).
        schema:
          type: integer
          minimum: 0
      responses:
        '200':
          description: SSE stream
          headers:
            X-Request-Id:
              $ref: '#/components/headers/XRequestId'
          content:
            text/event-stream:
              schema:
                type: string
              examples:
                envelope:
                  summary: Example SSE event (data is JSON EventEnvelope)
                  value: 'event: agentos.event

                    data: {"event":{"event_id":"evt_01J...","sequence":3,"time":"2025-12-19T22:15:31Z","type":"agentos.run.step.completed","tenant_id":"tnt_demo","agent_id":"agt_...","run_id":"run_01J...","step_id":"step_1","trace":{"traceparent":"00-...","span_id":"..."},"payload":{"status":"ok"}}}

                    '
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/RateLimited'
        '500':
          $ref: '#/components/responses/InternalError'
        '503':
          $ref: '#/components/responses/ServiceUnavailable'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    apiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
  headers:
    XRequestId:
      description: Request id assigned by the service (or propagated).
      schema:
        type: string
  parameters:
    AgentId:
      name: agent_id
      in: path
      required: true
      schema:
        type: string
    RunId:
      name: run_id
      in: path
      required: true
      schema:
        type: string
    XTenantId:
      name: X-Tenant-Id
      in: header
      required: false
      schema:
        type: string
      description: Optional explicit tenant header for S2S routing; auth-derived tenant
        remains authoritative.
    XCorrelationId:
      name: X-Correlation-Id
      in: header
      required: false
      schema:
        type: string
  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFound:
      description: Not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Conflict:
      description: Conflict
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    RateLimited:
      description: Rate limited
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    ServiceUnavailable:
      description: Service unavailable
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
  schemas:
    HealthResponse:
      type: object
      required:
      - status
      - service
      - version
      properties:
        status:
          type: string
          enum:
          - ok
        service:
          type: string
          enum:
          - agent-orchestrator
        version:
          type: string
    RunCreateRequest:
      type: object
      required:
      - input
      - context
      - tooling
      - run_options
      - idempotency_key
      properties:
        input:
          $ref: '#/components/schemas/RunInput'
        context:
          $ref: '#/components/schemas/RunContext'
        tooling:
          $ref: '#/components/schemas/Tooling'
        run_options:
          $ref: '#/components/schemas/RunOptions'
        idempotency_key:
          type: string
          maxLength: 256
    RunCreateResponse:
      type: object
      required:
      - run
      - correlation_id
      properties:
        run:
          $ref: '#/components/schemas/Run'
        correlation_id:
          type: string
    RunGetResponse:
      type: object
      required:
      - run
      - correlation_id
      properties:
        run:
          $ref: '#/components/schemas/Run'
        correlation_id:
          type: string
    RunCancelResponse:
      type: object
      required:
      - run
      - correlation_id
      properties:
        run:
          $ref: '#/components/schemas/Run'
        correlation_id:
          type: string
    RunStatus:
      type: string
      enum:
      - queued
      - running
      - completed
      - failed
      - canceled
    Run:
      type: object
      required:
      - tenant_id
      - agent_id
      - run_id
      - status
      - created_at
      - events_url
      properties:
        tenant_id:
          type: string
        agent_id:
          type: string
        run_id:
          type: string
        status:
          $ref: '#/components/schemas/RunStatus'
        created_at:
          type: string
          format: date-time
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
        events_url:
          type: string
          description: Relative URL for SSE event stream.
        run_options:
          $ref: '#/components/schemas/RunOptions'
        output:
          nullable: true
          oneOf:
          - $ref: '#/components/schemas/RunOutput'
        error:
          nullable: true
          oneOf:
          - $ref: '#/components/schemas/RunError'
    RunInput:
      type: object
      required:
      - type
      - text
      properties:
        type:
          type: string
          enum:
          - text
        text:
          type: string
    RunContext:
      type: object
      required:
      - locale
      - timezone
      properties:
        locale:
          type: string
        timezone:
          type: string
        channel:
          type: string
        user_id:
          type: string
        session_id:
          type: string
        metadata:
          type: object
          additionalProperties: true
        labels:
          type: object
          additionalProperties:
            type: string
    Tooling:
      type: object
      required:
      - tool_allowlist
      properties:
        tool_allowlist:
          type: array
          items:
            type: string
        tool_denymap:
          type: array
          items:
            type: string
    ToolDescriptor:
      type: object
      required:
      - name
      - kind
      properties:
        name:
          type: string
        kind:
          type: string
          enum:
          - http
          - function
          - builtin
        description:
          type: string
        config:
          type: object
          additionalProperties: true
        input_schema:
          type: object
          additionalProperties: true
    RunOptions:
      type: object
      required:
      - timeout_ms
      - max_steps
      properties:
        priority:
          type: string
          enum:
          - low
          - normal
          - high
          default: normal
        timeout_ms:
          type: integer
          minimum: 1
        max_steps:
          type: integer
          minimum: 1
        stream_events:
          type: boolean
        dry_run:
          type: boolean
          default: false
    RunOutput:
      type: object
      properties:
        type:
          type: string
          enum:
          - text
        text:
          type: string
        artifacts:
          type: array
          items:
            type: object
            additionalProperties: true
    RunError:
      type: object
      required:
      - code
      - message
      properties:
        code:
          type: string
        message:
          type: string
        details:
          type: object
          additionalProperties: true
    EventEnvelope:
      type: object
      required:
      - event
      properties:
        event:
          $ref: '#/components/schemas/Event'
    Event:
      type: object
      required:
      - event_id
      - sequence
      - time
      - type
      - tenant_id
      - agent_id
      - run_id
      - trace
      - payload
      properties:
        event_id:
          type: string
        sequence:
          type: integer
          minimum: 0
        time:
          type: string
          format: date-time
        type:
          type: string
        tenant_id:
          type: string
        agent_id:
          type: string
        run_id:
          type: string
        step_id:
          type: string
        trace:
          $ref: '#/components/schemas/TraceContext'
        payload:
          type: object
          additionalProperties: true
    TraceContext:
      type: object
      required:
      - traceparent
      - span_id
      properties:
        traceparent:
          type: string
        span_id:
          type: string
    ErrorResponse:
      type: object
      required:
      - error
      - correlation_id
      properties:
        error:
          $ref: '#/components/schemas/ErrorObject'
        correlation_id:
          type: string
    ErrorObject:
      type: object
      required:
      - code
      - message
      - retryable
      properties:
        code:
          type: string
        message:
          type: string
        retryable:
          type: boolean
        details:
          type: object
          additionalProperties: true
